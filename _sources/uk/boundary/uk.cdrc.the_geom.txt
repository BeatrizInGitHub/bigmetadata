.. _uk.cdrc.the_geom:

Census Output Areas
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The smallest unit for which census data are published in the UK.  They contain at least 40 households and 100 persons, the target size being 125 households. They were built up from postcode blocks after the census data were available, with the intention of standardising population sizes, geographical shape and social homogeneity (in terms of dwelling types and housing tenure). The OAs generated in 2001 were retained as far as possible for the publication of outputs from the 2011 Census (less than 3% were changed). -`Wikipedia <https://en.wikipedia.org/wiki/ONS_coding_system#Geography_of_the_UK_Census>`_











.. tabs::

   .. tab:: {"tab_name": "Boundaries within polygon"}
      Insert all  "Census Output Areas" geometries into another table:

      .. code-block:: postgresql

          INSERT INTO <table_to_update> (cartodb_id, the_geom, name, the_geom_webmercator)
          SELECT ROW_NUMBER() OVER () AS cartodb_id,
                 the_geom,
                 geom_refs,
                 ST_TRANSFORM(the_geom, 3857) the_geom_webmercator
          FROM OBS_GetBoundariesByGeometry(
            ST_GeomFromText('POLYGON((-8.4 49.8,-8.4 60.9,2.1 60.9,2.1 49.8,-8.4 49.8))', 4326),
            'uk.cdrc.the_geom'
          )

   .. tab:: {"tab_name": "Boundaries by identifier in another table"}

      Update the boundaries in another table matching the table's ID column.

      .. code-block:: postgresql

          WITH data AS (
            SELECT <geo_id> AS id
            FROM <table_to_update>
          ),
          meta AS (
            SELECT OBS_GetMeta(ST_MakeEnvelope(-179, 89, 179, -89, 4326),
              '[{"geom_id": "uk.cdrc.the_geom"}]'
            ) meta
          )
          UPDATE <table_to_update> SET
                the_geom = (data->0->>'value')::Geometry,
                the_geom_webmercator = ST_Transform((data->0->>'value')::Geometry, 3857)
          FROM OBS_GetData(
                (SELECT Array_agg(id) FROM data),
                (SELECT meta FROM meta)) obs_data
          WHERE <table_to_update>.<geo_id> = obs_data.id

      Obtain boundaries matched to another table's ID column.

      .. code-block:: postgresql

          WITH ids AS (
            SELECT ARRAY_AGG(<geo_id>) ids
            FROM <table_with_ids>
          ),
          meta AS (
            SELECT OBS_GetMeta(ST_MakeEnvelope(-179, 89, 179, -89, 4326),
              '[{"geom_id": "uk.cdrc.the_geom"}]'
            ) meta
          )
          SELECT ROW_NUMBER() OVER () AS cartodb_id,
                 data->0->>'geomref' as geomref,
                 (data->0->>'value')::Geometry as the_geom,
                 ST_Transform((data->0->>'value')::Geometry, 3857) AS the_geom_webmercator
          FROM OBS_GetData((SELECT ids FROM ids), (SELECT meta FROM meta))









Source
~~~~~~
    
      * :ref:`uk.cdrc.cdrc-source`
    


Time (default is latest)
~~~~~~~~~~~~~~~~~~~~~~~~
  
      * 2011
  


License
~~~~~~~
    
      * :ref:`tags.uk_ogl`
    